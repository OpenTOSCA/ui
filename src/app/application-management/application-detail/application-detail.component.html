<!--
  ~ Copyright (c) 2018 University of Stuttgart.
  ~
  ~ See the NOTICE file(s) distributed with this work for additional
  ~ information regarding copyright ownership.
  ~
  ~ This program and the accompanying materials are made available under the
  ~ terms of the Eclipse Public License 2.0 which is available at
  ~ http://www.eclipse.org/legal/epl-2.0, or the Apache Software License 2.0
  ~ which is available at https://www.apache.org/licenses/LICENSE-2.0.
  ~
  ~ SPDX-License-Identifier: EPL-2.0 OR Apache-2.0
  -->

<opentosca-action-bar>
    <opentosca-action-item (click)="dialogVisible = true;" styles="btn-primary">
        <i class="glyphicon glyphicon-plus"></i> Provision New Instance
    </opentosca-action-item>
</opentosca-action-bar>
<div class="container-fluid">
    <div class="row">
        <div class="col-5">
            <p-fieldset>
                <p-header><strong>Application Information</strong></p-header>
                <div *ngIf="(app | async); let app; else loading">
                    <div>
                        <h2>Description</h2>
                        <p *ngIf="app.description && app.description !== ''; else noDescription">
                            {{app.description}}
                        </p>
                        <ng-template #noDescription><p>No description provided.</p></ng-template>
                    </div>
                    <div>
                        <h2>Version</h2>
                        <p *ngIf="app?.version && app?.version !==''; else noVersion">
                            {{app.version}}
                        </p>
                        <ng-template #noVersion><p>No version provided.</p></ng-template>
                    </div>
                    <div>
                        <h2>Authors</h2>
                        <ul *ngIf="app?.authors?.length > 0; else noAuthors">
                            <li *ngFor="let author of app.authors">
                                {{author}}
                            </li>
                        </ul>
                        <ng-template #noAuthors><p>No authors provided.</p></ng-template>
                    </div>
                    <div>
                        <h2>Topology Template</h2>
                        <div>
                            <a *ngIf="app?.image_url && app?.image_url !== ''; else noTemplateImage"
                               [href]="app.image_url"
                               target="_blank">
                                <img class="img-responsive" style="max-width: 100%" [src]="app.image_url"/>
                            </a>
                        </div>
                        <ng-template #noTemplateImage><p>No Template Image provided.</p></ng-template>
                    </div>
                </div>
                <ng-template #loading>
                    <p>Loading app info...</p>
                </ng-template>
            </p-fieldset>
        </div>
        <div class="col-7">
            <p-fieldset>
                <p-header>Instances</p-header>
                <div class="row">
                    <div class="col-lg-12">
                        <opentosca-application-instance-list
                            (onTerminateInstance)="emitTerminationPlan($event)"
                            (onReloadInstances)="triggerUpdateAppInstancesList()">
                        </opentosca-application-instance-list>
                    </div>
                </div>
            </p-fieldset>
        </div>
    </div>
</div>

<opentosca-management-plan-execution-dialog [(visible)]="dialogVisible" [plan]="currentBuildPlan | async" [inputValidation]="false"></opentosca-management-plan-execution-dialog>
